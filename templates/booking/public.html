<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book a Session with {{ tutor.full_name }} - TutorHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 py-6">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center">
                    <span class="text-white font-bold text-lg">{{ tutor.full_name[0] }}</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">{{ tutor.full_name }}</h1>
                    <p class="text-gray-600">Tutoring Professional</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 py-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Tutor Info Sidebar -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-6 sticky top-6">
                    <!-- Profile -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <h2 class="text-lg font-bold text-gray-900 mb-3">About</h2>
                        <p class="text-gray-700 text-sm leading-relaxed">{{ tutor.bio }}</p>
                    </div>

                    <!-- Hourly Rate -->
                    <div class="mb-6 pb-6 border-b border-gray-200">
                        <p class="text-gray-600 text-sm font-medium">Hourly Rate</p>
                        <p class="text-3xl font-bold text-indigo-600 mt-2">${{ tutor.hourly_rate }}/hr</p>
                    </div>

                    <!-- Subjects -->
                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-gray-900 mb-3">Subjects</h3>
                        <div class="flex flex-wrap gap-2">
                            {% for subject in tutor.subject_list() %}
                            <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 text-xs font-semibold rounded-full">
                                {{ subject }}
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Form -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Book a Session</h2>

                    <form method="POST" action="{{ url_for('booking.confirm_booking', slug=tutor.profile_slug) }}" class="space-y-6">
                        <!-- Student Name -->
                        <div>
                            <label for="student_name" class="block text-sm font-medium text-gray-900">Your Name</label>
                            <input
                                type="text"
                                id="student_name"
                                name="student_name"
                                required
                                class="mt-2 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                placeholder="John Smith"
                            >
                        </div>

                        <!-- Parent Email -->
                        <div>
                            <label for="parent_email" class="block text-sm font-medium text-gray-900">Email Address</label>
                            <input
                                type="email"
                                id="parent_email"
                                name="parent_email"
                                required
                                class="mt-2 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                placeholder="john@example.com"
                            >
                        </div>

                        <!-- Parent Phone -->
                        <div>
                            <label for="parent_phone" class="block text-sm font-medium text-gray-900">Phone Number</label>
                            <input
                                type="tel"
                                id="parent_phone"
                                name="parent_phone"
                                class="mt-2 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                placeholder="(555) 123-4567"
                            >
                        </div>

                        <!-- Subject -->
                        <div>
                            <label for="subject" class="block text-sm font-medium text-gray-900">Subject</label>
                            <select
                                id="subject"
                                name="subject"
                                required
                                class="mt-2 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white"
                            >
                                <option value="">Select a subject...</option>
                                {% for subject in tutor.subject_list() %}
                                <option value="{{ subject }}">{{ subject }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Session Type -->
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-3">Session Type</label>
                            <div class="space-y-3">
                                <div class="flex items-center">
                                    <input
                                        type="radio"
                                        id="type_online"
                                        name="session_type"
                                        value="online"
                                        required
                                        class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 cursor-pointer"
                                    >
                                    <label for="type_online" class="ml-3 text-gray-700 cursor-pointer font-medium">
                                        Online
                                    </label>
                                </div>
                                <div class="flex items-center">
                                    <input
                                        type="radio"
                                        id="type_in_person"
                                        name="session_type"
                                        value="in-person"
                                        required
                                        class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 cursor-pointer"
                                    >
                                    <label for="type_in_person" class="ml-3 text-gray-700 cursor-pointer font-medium">
                                        In-Person
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Duration -->
                        <div>
                            <label for="duration" class="block text-sm font-medium text-gray-900">Duration</label>
                            <select
                                id="duration"
                                name="duration"
                                required
                                class="mt-2 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white"
                                onchange="updateTimeSlots()"
                            >
                                <option value="">Select duration...</option>
                                {% for duration in durations %}
                                <option value="{{ duration }}">{{ duration }} minutes</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Date Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-3">Select a Date</label>
                            <div class="grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50">
                                {% for date in dates %}
                                <button
                                    type="button"
                                    class="date-btn p-2 text-center rounded-lg border-2 border-gray-300 hover:border-indigo-500 transition text-sm font-medium"
                                    data-date="{{ date.strftime('%Y-%m-%d') }}"
                                    onclick="selectDate(this)"
                                >
                                    <div class="text-xs text-gray-600">{{ date.strftime('%a') }}</div>
                                    <div>{{ date.strftime('%m/%d') }}</div>
                                </button>
                                {% endfor %}
                            </div>
                            <input type="hidden" id="selected_date" name="date">
                        </div>

                        <!-- Time Slots -->
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-3">Select a Time</label>
                            <div id="time_slots_container" class="grid grid-cols-3 sm:grid-cols-4 gap-2 border border-gray-200 rounded-lg p-3 bg-gray-50">
                                <p class="col-span-full text-center text-gray-600 text-sm">Select a date and duration to view available times</p>
                            </div>
                            <input type="hidden" id="selected_time" name="time">
                        </div>

                        <!-- Hidden inputs for form -->
                        <div class="border-t border-gray-200 pt-6">
                            <button
                                type="submit"
                                class="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition flex items-center justify-center space-x-2"
                            >
                                <span>Confirm Booking</span>
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-16">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 text-center">
            <p class="text-gray-600 text-sm">Powered by <span class="font-semibold text-indigo-600">TutorHub</span></p>
        </div>
    </footer>

    <script>
    function selectDate(button) {
        // Remove active state from all date buttons
        document.querySelectorAll('.date-btn').forEach(btn => {
            btn.classList.remove('border-indigo-500', 'bg-indigo-50', 'text-indigo-700');
            btn.classList.add('border-gray-300', 'text-gray-900');
        });

        // Add active state to clicked button
        button.classList.remove('border-gray-300', 'text-gray-900');
        button.classList.add('border-indigo-500', 'bg-indigo-50', 'text-indigo-700');

        // Set the hidden date input
        const selectedDate = button.getAttribute('data-date');
        document.getElementById('selected_date').value = selectedDate;

        // Update time slots
        updateTimeSlots();
    }

    function updateTimeSlots() {
        const date = document.getElementById('selected_date').value;
        const duration = document.getElementById('duration').value;

        if (!date || !duration) {
            document.getElementById('time_slots_container').innerHTML =
                '<p class="col-span-full text-center text-gray-600 text-sm">Select a date and duration to view available times</p>';
            return;
        }

        // Fetch available time slots via AJAX
        const tutorId = "{{ tutor.id }}";
        fetch(`/api/slots/${tutorId}/${date}?duration=${duration}`)
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('time_slots_container');
                container.innerHTML = '';

                if (data.slots && data.slots.length > 0) {
                    data.slots.forEach(slot => {
                        const button = document.createElement('button');
                        button.type = 'button';
                        button.className = 'time-slot-btn p-2 text-center rounded-lg border-2 border-gray-300 hover:border-indigo-500 transition text-sm font-medium';
                        button.textContent = slot;
                        button.onclick = function() {
                            selectTimeSlot(this, slot);
                        };
                        container.appendChild(button);
                    });
                } else {
                    container.innerHTML = '<p class="col-span-full text-center text-gray-600 text-sm">No available times for this date</p>';
                }
            })
            .catch(error => {
                console.error('Error fetching time slots:', error);
                document.getElementById('time_slots_container').innerHTML =
                    '<p class="col-span-full text-center text-red-600 text-sm">Error loading available times</p>';
            });
    }

    function selectTimeSlot(button, time) {
        // Remove active state from all time slot buttons
        document.querySelectorAll('.time-slot-btn').forEach(btn => {
            btn.classList.remove('border-indigo-500', 'bg-indigo-50', 'text-indigo-700');
            btn.classList.add('border-gray-300', 'text-gray-900');
        });

        // Add active state to clicked button
        button.classList.remove('border-gray-300', 'text-gray-900');
        button.classList.add('border-indigo-500', 'bg-indigo-50', 'text-indigo-700');

        // Set the hidden time input
        document.getElementById('selected_time').value = time;
    }

    // Set default session type
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('type_online').checked = true;
    });
    </script>
</body>
</html>
