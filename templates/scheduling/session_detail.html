{% extends "base.html" %}

{% block title %}Session Details - TutorHub{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Session Info Card -->
    <div class="bg-white rounded-lg shadow-md p-8 mb-6">
        <div class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">{{ session.student_display_name() }}</h1>
                <p class="text-gray-600 mt-1">Session Details</p>
            </div>
            <span class="inline-block px-4 py-2 text-sm font-semibold rounded-full
                {% if session.status == 'scheduled' %}bg-yellow-100 text-yellow-800
                {% elif session.status == 'completed' %}bg-green-100 text-green-800
                {% elif session.status == 'cancelled' %}bg-red-100 text-red-800
                {% endif %}">
                {{ session.status | upper }}
            </span>
        </div>

        <div class="grid grid-cols-2 gap-6 mb-8 pb-8 border-b border-gray-200">
            <div>
                <p class="text-sm text-gray-600 font-medium">Date & Time</p>
                <p class="text-lg font-semibold text-gray-900 mt-1">
                    {{ session.scheduled_at.strftime('%B %d, %Y') }}
                </p>
                <p class="text-lg font-semibold text-gray-900">
                    {{ session.scheduled_at.strftime('%I:%M %p') }}
                </p>
            </div>
            <div>
                <p class="text-sm text-gray-600 font-medium">Duration</p>
                <p class="text-lg font-semibold text-gray-900 mt-1">{{ session.duration_minutes }} minutes</p>
            </div>
            <div>
                <p class="text-sm text-gray-600 font-medium">Session Type</p>
                <p class="text-lg font-semibold text-gray-900 mt-1">
                    <span class="inline-block px-3 py-1 text-sm font-semibold rounded-full {% if session.session_type == 'online' %}bg-blue-100 text-blue-800{% else %}bg-purple-100 text-purple-800{% endif %}">
                        {{ session.session_type | upper }}
                    </span>
                </p>
            </div>
            <div>
                <p class="text-sm text-gray-600 font-medium">
                    {% if session.session_type == 'online' %}Meeting Link{% else %}Location{% endif %}
                </p>
                <p class="text-gray-900 mt-1">
                    {% if session.session_type == 'online' and session.meeting_link %}
                        <a href="{{ session.meeting_link }}" target="_blank" class="text-indigo-600 hover:text-indigo-700 break-all">{{ session.meeting_link }}</a>
                    {% elif session.session_type == 'in-person' and session.location %}
                        {{ session.location }}
                    {% else %}
                        <span class="text-gray-500">Not provided</span>
                    {% endif %}
                </p>
            </div>
        </div>

        <!-- Student Info -->
        <div class="mb-8 pb-8 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Student Information</h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <p class="text-sm text-gray-600">Name</p>
                    <p class="text-gray-900 font-medium">{{ session.student.name }}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Email</p>
                    <p class="text-gray-900 font-medium">{{ session.student.email }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Actions Based on Status -->
    {% if session.status == 'scheduled' %}
    <!-- Mark as Completed Form -->
    <div class="bg-white rounded-lg shadow-md p-8 mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Complete Session</h2>

        <form method="POST" action="{{ url_for('scheduling.session_detail', session_id=session.id) }}" class="space-y-6">
            <input type="hidden" name="action" value="complete">

            <!-- Notes -->
            <div>
                <label for="notes" class="block text-sm font-medium text-gray-900">Session Notes</label>
                <textarea
                    id="notes"
                    name="notes"
                    rows="4"
                    placeholder="Summarize what was covered in this session..."
                    class="mt-2 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                ></textarea>
            </div>

            <!-- Homework -->
            <div>
                <label for="homework" class="block text-sm font-medium text-gray-900">Homework Assigned</label>
                <textarea
                    id="homework"
                    name="homework"
                    rows="4"
                    placeholder="What homework did you assign for the next session?..."
                    class="mt-2 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                ></textarea>
            </div>

            <!-- Progress Rating -->
            <div>
                <label class="block text-sm font-medium text-gray-900 mb-3">Student Progress</label>
                <div class="space-y-2">
                    {% for rating in [1, 2, 3, 4, 5] %}
                    <div class="flex items-center">
                        <input
                            type="radio"
                            id="rating_{{ rating }}"
                            name="progress_rating"
                            value="{{ rating }}"
                            class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 cursor-pointer"
                        >
                        <label for="rating_{{ rating }}" class="ml-3 text-gray-700 cursor-pointer">
                            {% if rating == 1 %}Needs Improvement
                            {% elif rating == 2 %}Below Average
                            {% elif rating == 3 %}Average
                            {% elif rating == 4 %}Good
                            {% elif rating == 5 %}Excellent
                            {% endif %}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-between pt-6 border-t border-gray-200">
                <form method="POST" action="{{ url_for('scheduling.session_detail', session_id=session.id) }}" style="display: inline;">
                    <input type="hidden" name="action" value="cancel">
                    <button
                        type="submit"
                        class="px-6 py-2 text-red-600 border border-red-300 rounded-lg font-medium hover:bg-red-50 transition"
                        onclick="return confirm('Are you sure you want to cancel this session?')"
                    >
                        Cancel Session
                    </button>
                </form>

                <button
                    type="submit"
                    class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition"
                >
                    Mark as Completed
                </button>
            </div>
        </form>
    </div>

    {% elif session.status == 'completed' %}
    <!-- Completed Session Info -->
    <div class="bg-white rounded-lg shadow-md p-8 mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Session Completion Details</h2>

        <div class="space-y-6 pb-8 border-b border-gray-200">
            {% if session.notes %}
            <div>
                <p class="text-sm text-gray-600 font-medium">Session Notes</p>
                <p class="text-gray-900 mt-2 whitespace-pre-wrap">{{ session.notes }}</p>
            </div>
            {% endif %}

            {% if session.homework %}
            <div>
                <p class="text-sm text-gray-600 font-medium">Homework Assigned</p>
                <p class="text-gray-900 mt-2 whitespace-pre-wrap">{{ session.homework }}</p>
            </div>
            {% endif %}

            {% if session.progress_rating %}
            <div>
                <p class="text-sm text-gray-600 font-medium">Student Progress</p>
                <p class="text-gray-900 mt-2">
                    {% if session.progress_rating == 1 %}Needs Improvement
                    {% elif session.progress_rating == 2 %}Below Average
                    {% elif session.progress_rating == 3 %}Average
                    {% elif session.progress_rating == 4 %}Good
                    {% elif session.progress_rating == 5 %}Excellent
                    {% endif %}
                    ({{ session.progress_rating }}/5)
                </p>
            </div>
            {% endif %}
        </div>

        <!-- Payment Status -->
        <div class="mb-6">
            <p class="text-sm text-gray-600 font-medium mb-3">Payment Status</p>
            <form method="POST" action="{{ url_for('scheduling.session_detail', session_id=session.id) }}" class="flex items-center space-x-4">
                <input type="hidden" name="action" value="toggle_payment">
                <span class="inline-block px-4 py-2 text-sm font-semibold rounded-full {% if session.paid %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                    {% if session.paid %}Paid{% else %}Unpaid{% endif %}
                </span>
                <button
                    type="submit"
                    class="px-4 py-2 text-sm font-medium rounded-lg transition {% if session.paid %}text-red-600 border border-red-300 hover:bg-red-50{% else %}text-green-600 border border-green-300 hover:bg-green-50{% endif %}"
                >
                    Mark as {% if session.paid %}Unpaid{% else %}Paid{% endif %}
                </button>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Back Button -->
    <div class="text-center mb-6">
        <a href="{{ url_for('scheduling.sessions_list') }}" class="text-indigo-600 hover:text-indigo-700 font-medium">
            â Back to Sessions
        </a>
    </div>
</div>
{% endblock %}
